<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title></title>
        <script src="three.js" type="text/javascript"></script>
    </head>


    <body>
        <div id="container">


        </div>

        
        <script>
      
            var camera, scene, renderer;
            
            /*
             * The skined mesh and animation global variables
             */
            var skinnedMesh, animation;


            /*
             * Loading the skinned mesh from a file "animation.js" located in 
             * the same folder
             */
            var loader = new THREE.JSONLoader();
            loader.load("animation.js", createSkinnedMesh)
            
            /**
             * Create a skinned mesh
             */
            function createSkinnedMesh(geometry, materials) {
                skinnedMesh = new THREE.SkinnedMesh(geometry, new THREE.MeshFaceMaterial(materials));
                enableSkinning(skinnedMesh);
                init();
                
            }
            
            /**
             * Enable the material skinning on every material in 
             * THREE.MeshFaceMaterial materials collection
             */
            function enableSkinning(skinnedMesh) {
                var materials = skinnedMesh.material.materials;
                for (var i = 0,length = materials.length; i < length; i++) {
                    var mat = materials[i];
                    mat.skinning = true;
                }
            }
            
            function init() {
                /**************************************************************
                 * The following code is not related to the skinning it's just 
                 * basic scene setup
                 **************************************************************/
                camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 10000 );
                camera.position.z = 10

                scene = new THREE.Scene();

                geometry = new THREE.CubeGeometry( 200, 200, 200 );
                material = new THREE.MeshBasicMaterial( { color: 0xff0000, wireframe: true } );

                mesh = new THREE.Mesh( geometry, material );
                scene.add( mesh );
                
                renderer = new THREE.WebGLRenderer({antialias: true});
                renderer.setSize( window.innerWidth, window.innerHeight );
                renderer.setClearColorHex(0x0000ff, 0.6)
                document.body.appendChild( renderer.domElement );
                
                
                /* *************************************************************
                 * Here we are adding the skinned mesh to the scene
                 * and 
                 **************************************************************/
                scene.add(skinnedMesh);
                
                /*
                 * It is required for the animation name to be recognisable to
                 * add animation data from the geometry to THREE.AnimationHandler
                 * (currently this is the only way i found animations possible)
                 * and probably this is the most efficient way to deal with animations
                 */ 
                THREE.AnimationHandler.add(skinnedMesh.geometry.animation);
                
                /*
                 * the animation global variable is set to instance of 
                 * THREE.Animation 
                 * */
                // The animation constructor takes 3 arguments: 
                // 1) The SkinnedMesh instance to be animated
                // 2) The animation name exported to the JSON file
                // 3) Interpolation mode: could be: 
                //      THREE.AnimationHandler.LINEAR or
                //      THREE.AnimationHandler.CATMULLROM
                animation = new THREE.Animation(skinnedMesh, "ArmatureAction", THREE.AnimationHandler.CATMULLROM)
                animation.play();
                
                
                /*
                 * Run the animation loop
                 */
                animate()
            }

            function animate() {
                requestAnimationFrame( animate );
                
                
                /*
                 * Here the mesh animation is updated
                 * the argument for update method should be delta time since
                 * last frame in miliseconds
                 * for simplicity I've sent 0.01 miliseconds value what
                 * should display the animation
                 */
                animation.update(0.01)
                


                renderer.render( scene, camera );

            }
            
         
            
        </script>






    </body>
</html>
